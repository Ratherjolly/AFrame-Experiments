<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
	<script src="https://rawgit.com/mayognaise/aframe-gif-shader/master/dist/aframe-gif-shader.min.js"></script>
	<script src="https://rawgit.com/jeromeetienne/ar.js/master/aframe/build/aframe-ar.js"></script>
	<script>THREEx.ArToolkitContext.baseURL = 'https://rawgit.com/jeromeetienne/ar.js/master/three.js/'</script>
	<style>body {
	background: #000;
	overflow: hidden;
}

canvas {
	display: block;
}</style>
	<script>
	// click-listener component to pass window clicks to an entity.
	AFRAME.registerComponent('click-listener', {
	  	init: function () {
		var el = this.el;
		const mdl = document.querySelector('#ModelId');
		const _mdlCnt = 3;
			  
		window.addEventListener('click', function () {
			
			var MI = document.getElementById('ModelIndex');
			    var i = 0;
			    i += parseFloat(MI.innerHTML);
				i += 1;

			    if (i > _mdlCnt)
				i = 1;
			    MI.innerHTML = i;
			    if (i==1) {
						mdl.setAttribute('obj-model', 'obj: #bear-obj;');
						mdl.setAttribute('scale', '0.01 0.01 0.01');
						mdl.setAttribute('position', '0 0 0');
			    }
			    else if (i==2) {
						mdl.setAttribute('obj-model', 'obj: #brawler-obj;');
						mdl.setAttribute('scale', '0.25 0.25 0.25');
						mdl.setAttribute('position', '0 0 0');
			    }
			    else if (i==3) {
						mdl.setAttribute('obj-model', 'obj: #cube-obj;');
						mdl.setAttribute('scale', '0.05 0.05 0.05');
						Init();
			    }
				else if (i==4) {
						mdl.setAttribute('obj-loader', 'url(./Objects/DynamoSitting1.obj)');
						mdl.setAttribute('scale', '0.05 0.05 0.05');
						removeElementsByClass('flames');
			    }
		    });
		  }
		});
	</script>
	<script>
	function Init() {
            const mScene = document.getElementById('TheScene');
            const posArr = [-10,-9,-8,-7,-6,-5,-4,4,5,6,7,8,9,10];
           	var catCnt = 6;
            //removeElementsByClass('flames');

            for(var i = 0; i<catCnt; i++){
                var tempArr = shuffleArray(posArr);
                
                var temp = document.createElement('a-entity');
                setAttributes(temp, {
                    "geometry": "'primitive:circle;segments:9;radius:3.0sawsaw;'",
                    "material": "'shader:gif;src:url(img/cat_lg.gif);opacity:.8'",
                    "class": "flames",
                    "scale":"1 1 1"
                });
				console.log(temp);
                mScene.appendChild(temp);
            }
        };
	function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i];
                array[i] = array[j];
                array[j] = temp;
            }
            return array;
        };
	function removeElementsByClass(className) {
            var elements = document.getElementsByClassName(className);
            while (elements.length > 0) {
                elements[0].parentNode.removeChild(elements[0]);
            }
        };
	function setAttributes(el, attrs) {
            for (var key in attrs) {
                el.setAttribute(key, attrs[key]);
            }
        };
		
		//-------------------------------------------------
var canvas,
	ctx,
	width,
	height,
	size,
	lines,
	tick;

function line() {
	this.path = [];
	this.speed = rand( 10, 20 );
	this.count = randInt( 10, 30 );
	this.x = width / 2, + 1;
	this.y = height / 2 + 1;
	this.target = { x: width / 2, y: height / 2 };
	this.dist = 0;
	this.angle = 0;
	this.hue = tick / 5;
	this.life = 1;
	this.updateAngle();
	this.updateDist();
}

line.prototype.step = function( i ) {
	this.x += Math.cos( this.angle ) * this.speed;
	this.y += Math.sin( this.angle ) * this.speed;
	
	this.updateDist();
	
	if( this.dist < this.speed ) {
		this.x = this.target.x;
		this.y = this.target.y;
		this.changeTarget();
	}
		
	this.path.push( { x: this.x, y: this.y } );	
	if( this.path.length > this.count ) {
		this.path.shift();
	}
	
	this.life -= 0.001;
	
	if( this.life <= 0 ) {
		this.path = null;
		lines.splice( i, 1 );	
	}
};

line.prototype.updateDist = function() {
	var dx = this.target.x - this.x,
		dy = this.target.y - this.y;
	this.dist = Math.sqrt( dx * dx + dy * dy );
}

line.prototype.updateAngle = function() {
	var dx = this.target.x - this.x,
		dy = this.target.y - this.y;
	this.angle = Math.atan2( dy, dx );
}

line.prototype.changeTarget = function() {
	var randStart = randInt( 0, 3 );
	switch( randStart ) {
		case 0: // up
			this.target.y = this.y - size;
			break;
		case 1: // right
			this.target.x = this.x + size;
			break;
		case 2: // down
			this.target.y = this.y + size;
			break;
		case 3: // left
			this.target.x = this.x - size;
	}
	this.updateAngle();
};

line.prototype.draw = function( i ) {
	ctx.beginPath();
	var rando = rand( 0, 10 );
	for( var j = 0, length = this.path.length; j < length; j++ ) {
		ctx[ ( j === 0 ) ? 'moveTo' : 'lineTo' ]( this.path[ j ].x + rand( -rando, rando ), this.path[ j ].y + rand( -rando, rando ) );
	}
	ctx.strokeStyle = 'hsla(' + rand( this.hue, this.hue + 30 ) + ', 80%, 55%, ' + ( this.life / 3 ) + ')';
	ctx.lineWidth = rand( 0.1, 2 );
	ctx.stroke();
};

function rand( min, max ) {
	return Math.random() * ( max - min ) + min;
}

function randInt( min, max ) {
	return Math.floor( min + Math.random() * ( max - min + 1 ) );
};

function init() {
	var canvas = document.getElementById( 'canvas' );
	ctx = canvas.getContext( '2d' );
	size = 30;
	lines = [];
	reset();
	loop();
}

function reset() {
	width = Math.ceil( window.innerWidth / 2 ) * 2;
	height = Math.ceil( window.innerHeight / 2 ) * 2;
	tick = 0;
	
	lines.length = 0;	
	canvas.width = width;
	canvas.height = height;
}

function create() {
	if( tick % 10 === 0 ) {		
		lines.push( new line());
	}
}

function step() {
	var i = lines.length;
	while( i-- ) {
		lines[ i ].step( i );	
	}
}

function clear() {
	ctx.globalCompositeOperation = 'destination-out';
	ctx.fillStyle = 'hsla(0, 0%, 0%, 0.1';
	ctx.fillRect( 0, 0, width, height );
	ctx.globalCompositeOperation = 'lighter';
}

function draw() {
	ctx.save();
	ctx.translate( width / 2, height / 2 );
	ctx.rotate( tick * 0.001 );
	var scale = 0.8 + Math.cos( tick * 0.02 ) * 0.2;
	ctx.scale( scale, scale );
	ctx.translate( -width / 2, -height / 2 );
	var i = lines.length;
	while( i-- ) {
		lines[ i ].draw( i );	
	}
	ctx.restore();
}

function loop() {
	requestAnimationFrame( loop );
	create();
	step();
	clear();
	draw();
	tick++;
}

function onresize() {
	reset();	
}

window.addEventListener( 'resize', onresize );

init();
	</script>
</head>
<body style='margin : 0px; overflow: hidden;'>
	<canvas id="canvas"></canvas>
	<a-scene stats embedded id="TheScene" artoolkit='sourceType: webcam; detectionMode: mono; maxDetectionRate: 30; canvasWidth: 240; canvasHeight: 180'>
	<!--<a-scene embedded artoolkit='sourceType: webcam;' id="TheScene">-->
	  <a-assets>
		<a-asset-item id="brawler-obj" src="./Objects/BrawlerSmoothFists.obj"></a-asset-item>
		<a-asset-item id="bear-obj" src="./Objects/LancerBear.obj"></a-asset-item>
	  	<a-asset-item id="cube-obj" src="./Objects/TheCube1.obj"></a-asset-item>
	  </a-assets>
		
		<a-entity position="-2.5 0 1.5" rotation="-30 0 0" color="black" id="ModelTxt" text-geometry="" scale="" visible=""></a-entity>
		<a-entity position="-1 1 1.5" scale="0.5 0.5 0.5" color="black" id="StartTxt" text-geometry="" rotation="" visible=""></a-entity>
		
		<!-- handle brawler marker -->
		<a-marker url='./markers/ARBattleRock7.png' id="modelMarker">
			<a-entity id="ModelId" material='opacity: 0.8; color: red' scale="0.25 0.25 0.25" obj-model="obj: #brawler-obj;">
				<a-animation attribute="rotation" dur="6000" easing="linear" repeat="indefinite" to="0 360 0"></a-animation>
			</a-entity>
			<a-entity geometry="primitive:plane;width:2;height:2;" material="shader:gif;src:url(./images/fire1.gif);opacity:.8"></a-entity>
			<div id="ModelIndex">0</div>
		</a-marker>
		
		<!-- handle unknown marker 
		<a-marker type='unknown'>
			<a-box depth="1" height="1" width="1" position='0 0 0.5' material='opacity: 0.5; side:double; color:blue;'></a-box>
		</a-marker>-->
		<!--<a-entity position='0 0 0.5' rotation="0 180 0" material='opacity: 0.5;' scale="0.2 0.2 0.2" obj-model="obj: #brawler-obj;"></a-entity>
		<a-box position='0 0 0.5' material='opacity: 0.5;'></a-box>
		<a-entity position='0 0 0.5' material='opacity: 0.5;' scale="0.01 0.01 0.01" obj-model="obj: #bear-obj;"></a-entity>
		<a-marker-camera url='./markers/ARBattleRock.png' ></a-marker-camera>-->
		
		<!-- handle bear marker 
		<a-marker url='./markers/ARBattleRock2.png'>
			<a-entity position='0 0 0.5' rotation="0 180 0" material='opacity: 0.5;' scale="0.2 0.2 0.2" obj-model="obj: #bear-obj;"></a-entity>
		</a-marker>-->
		
		<!-- add a simple camera -->
		<a-entity id="camera" camera click-listener></a-entity>
		
	</a-scene>
</body>
</html>
